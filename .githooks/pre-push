#!/usr/bin/env bash
#
# pre-push hook â€” runs CI-parity lint and tests before every push.
# Install:  git config core.hooksPath .githooks
# Skip:     git push --no-verify

set -euo pipefail

repo_root="$(git rev-parse --show-toplevel)"

echo "==> pre-push: running Rust lint checks (CI parity)..."
"$repo_root/scripts/ci/rust-lint.sh" || {
    echo "FAIL: CI-parity rust lint checks failed."
    exit 1
}

echo "==> pre-push: running tests (CI parity)..."
cargo test --locked --verbose || {
    echo "FAIL: some tests did not pass."
    exit 1
}

echo "==> pre-push: all checks passed."
